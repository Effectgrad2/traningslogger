<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <title>Träningslogg</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      color-scheme: dark;
      --bg: #050814;
      --bg-card: #070c1b;
      --bg-card-alt: #0b1224;
      --accent: #3b82f6;
      --accent-soft: rgba(59,130,246,0.15);
      --text: #e5e7eb;
      --text-muted: #9ca3af;
      --danger: #ef4444;
      --border: #111827;
      --radius-lg: 16px;
      --radius-md: 10px;
      --shadow-soft: 0 18px 40px rgba(0,0,0,0.45);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #0b1120 0, #020617 55%, #020617 100%);
      color: var(--text);
    }

    .page {
      max-width: 1080px;
      margin: 0 auto;
      padding: 24px 16px 40px;
    }

    h1 {
      font-size: 1.9rem;
      margin: 0 0 4px;
    }

    .subtitle {
      color: var(--text-muted);
      font-size: 0.9rem;
      margin-bottom: 20px;
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.2fr);
      gap: 18px;
    }

    @media (max-width: 880px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: linear-gradient(145deg, var(--bg-card), var(--bg-card-alt));
      border-radius: var(--radius-lg);
      border: 1px solid rgba(15, 23, 42, 0.9);
      padding: 14px 16px 16px;
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
    }

    .card h2 {
      margin: 0 0 4px;
      font-size: 1.05rem;
    }

    .label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .small {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .tabs {
      display: flex;
      gap: 6px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .tab {
      padding: 5px 10px;
      border-radius: 999px;
      font-size: 0.8rem;
      border: 1px solid rgba(30,64,175,0.6);
      background: transparent;
      color: var(--text-muted);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: all 0.15s ease;
    }

    .tab-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: rgba(96, 165, 250, 0.6);
    }

    .tab.active {
      background: radial-gradient(circle at top left, rgba(96,165,250,0.4), rgba(15,23,42,0.9));
      color: #e5f0ff;
      border-color: rgba(129,140,248,0.8);
      box-shadow: 0 0 0 1px rgba(59,130,246,0.3);
    }

    .section-title {
      font-size: 0.9rem;
      margin: 10px 0 6px;
    }

    .exercise-list {
      display: flex;
      flex-direction: column;
      gap: 4px;
      max-height: 420px;
      overflow-y: auto;
      padding-right: 4px;
      margin-top: 4px;
    }

    .exercise-item {
      border-radius: var(--radius-md);
      border: 1px solid rgba(15,23,42,0.9);
      background: rgba(15,23,42,0.7);
      padding: 7px 9px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      transition: all 0.12s ease;
    }

    .exercise-item:hover {
      border-color: rgba(59,130,246,0.7);
      background: radial-gradient(circle at left, rgba(37,99,235,0.2), rgba(15,23,42,0.95));
      transform: translateY(-1px);
    }

    .exercise-item.active {
      border-color: var(--accent);
      background: radial-gradient(circle at left, rgba(59,130,246,0.32), rgba(15,23,42,0.96));
      box-shadow: 0 0 0 1px rgba(59,130,246,0.4);
    }

    .exercise-name {
      font-size: 0.9rem;
    }

    .pill {
      font-size: 0.7rem;
      border-radius: 999px;
      padding: 1px 7px;
      border: 1px solid rgba(148,163,184,0.5);
      color: var(--text-muted);
      white-space: nowrap;
    }

    .selected-exercise {
      margin-top: 6px;
      padding: 10px 10px 9px;
      border-radius: 12px;
      background: radial-gradient(circle at top left, rgba(59,130,246,0.15), rgba(15,23,42,0.95));
      border: 1px solid rgba(37,99,235,0.7);
    }

    .selected-exercise-name {
      font-size: 1rem;
      font-weight: 600;
    }

    .selected-extra {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .muted {
      color: var(--text-muted);
      font-size: 0.8rem;
    }

    .badge {
      font-size: 0.68rem;
      padding: 1px 6px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      color: #9ca3af;
    }

    .empty-state {
      margin-top: 6px;
      padding: 10px;
      border-radius: 10px;
      border: 1px dashed rgba(51,65,85,0.9);
      color: var(--text-muted);
      font-size: 0.8rem;
      background: rgba(15,23,42,0.7);
    }
  </style>
</head>
<body>
  <div class="page">
    <header style="margin-bottom: 18px;">
      <h1>Träningslogg</h1>
      <div class="subtitle">Logga vikt, set och reps. Se föregående pass per övning (kommer snart). Just nu kopplar vi bara in övningslistan från Google Sheets.</div>
    </header>

    <div class="layout">
      <!-- Vänster: muskelgrupp & lista -->
      <section class="card" id="exerciseCard">
        <div class="label">Pass / flikar</div>
        <div id="tabs" class="tabs"></div>

        <div class="label" style="margin-top: 8px;">Valt pass</div>
        <div id="currentGroupLabel" class="small">–</div>

        <div class="section-title">Övningar</div>
        <div id="exerciseList" class="exercise-list"></div>

        <div id="exerciseListEmpty" class="empty-state" style="display:none;">
          Inga övningar hittades för det här passet. Kontrollera <strong>default_day</strong> i <em>Exercises</em>-arket.
        </div>

        <div id="loadingState" class="empty-state">
          Hämtar övningar från Google Sheets via Make …
        </div>

      </section>

      <!-- Höger: vald övning (placeholder för loggning) -->
      <section class="card">
        <h2>Vald övning</h2>
        <div id="selectedExerciseBox" class="selected-exercise" style="display:none;">
          <div class="selected-exercise-name" id="selectedExerciseName"></div>
          <div class="selected-extra" id="selectedExerciseMeta"></div>
        </div>
        <div id="noExerciseSelected" class="empty-state">
          Välj en övning i listan till vänster för att se detaljer och (senare) logga set/reps.
        </div>

        <div style="margin-top: 14px;">
          <div class="label">Status</div>
          <div id="statusText" class="muted">Väntar på data …</div>
        </div>
      </section>
    </div>
  </div>

  <script>
    // ===========================
    // KONFIG
    // ===========================
   const GET_EXERCISES_URL = "https://hook.eu1.make.com/miwhojysjdj59j9wy5cos6dttot8v91h";
 

    // ===========================
    // STATE
    // ===========================
    let EXERCISES = [];          // Fylls från API
    let MUSCLE_GROUP_TABS = [];  // { key: "Pass 1", label: "Pass 1" }
    let currentGroupKey = null;
    let currentExercise = null;

    // ===========================
    // DOM-referenser
    // ===========================
    const tabsEl = document.getElementById("tabs");
    const exerciseListEl = document.getElementById("exerciseList");
    const currentGroupLabelEl = document.getElementById("currentGroupLabel");
    const selectedExerciseBoxEl = document.getElementById("selectedExerciseBox");
    const selectedExerciseNameEl = document.getElementById("selectedExerciseName");
    const selectedExerciseMetaEl = document.getElementById("selectedExerciseMeta");
    const noExerciseSelectedEl = document.getElementById("noExerciseSelected");
    const statusTextEl = document.getElementById("statusText");
    const exerciseListEmptyEl = document.getElementById("exerciseListEmpty");
    const loadingStateEl = document.getElementById("loadingState");

    // ===========================
    // Render funktioner
    // ===========================
    function renderTabs() {
      tabsEl.innerHTML = "";

      if (!MUSCLE_GROUP_TABS.length) {
        tabsEl.innerHTML = '<span class="small">Inga pass hittades.</span>';
        return;
      }

      MUSCLE_GROUP_TABS.forEach(tab => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "tab" + (tab.key === currentGroupKey ? " active" : "");
        btn.innerHTML = '<span class="tab-dot"></span>' + tab.label;
        btn.onclick = () => {
          currentGroupKey = tab.key;
          currentExercise = null;
          renderTabs();
          renderExerciseList();
          renderSelectedExercise();
        };
        tabsEl.appendChild(btn);
      });
    }

    function renderExerciseList() {
      exerciseListEl.innerHTML = "";

      if (!currentGroupKey) {
        currentGroupLabelEl.textContent = "–";
        exerciseListEmptyEl.style.display = "block";
        return;
      }

      currentGroupLabelEl.textContent = currentGroupKey;

      const filtered = EXERCISES.filter(ex => ex.default_day === currentGroupKey);

      if (!filtered.length) {
        exerciseListEmptyEl.style.display = "block";
        return;
      }
      exerciseListEmptyEl.style.display = "none";

      filtered.forEach(ex => {
        const item = document.createElement("div");
        const isActive = currentExercise && currentExercise.exercise_id === ex.exercise_id;
        item.className = "exercise-item" + (isActive ? " active" : "");
        item.onclick = () => {
          currentExercise = ex;
          renderExerciseList();
          renderSelectedExercise();
        };

        const left = document.createElement("div");
        left.style.display = "flex";
        left.style.flexDirection = "column";

        const nameDiv = document.createElement("div");
        nameDiv.className = "exercise-name";
        nameDiv.textContent = ex.name;

        const subDiv = document.createElement("div");
        subDiv.className = "small";
        subDiv.textContent = ex.muscle_group;

        left.appendChild(nameDiv);
        left.appendChild(subDiv);

        const right = document.createElement("div");
        right.style.display = "flex";
        right.style.flexDirection = "column";
        right.style.alignItems = "flex-end";
        right.style.gap = "4px";

        const unitSpan = document.createElement("span");
        unitSpan.className = "pill";
        unitSpan.textContent = ex.default_unit || "kg";

        const idSpan = document.createElement("span");
        idSpan.className = "badge";
        idSpan.textContent = `ID ${ex.exercise_id}`;

        right.appendChild(unitSpan);
        right.appendChild(idSpan);

        item.appendChild(left);
        item.appendChild(right);
        exerciseListEl.appendChild(item);
      });
    }

    function renderSelectedExercise() {
      if (!currentExercise) {
        selectedExerciseBoxEl.style.display = "none";
        noExerciseSelectedEl.style.display = "block";
        return;
      }

      selectedExerciseBoxEl.style.display = "block";
      noExerciseSelectedEl.style.display = "none";

      selectedExerciseNameEl.textContent = currentExercise.name;
      selectedExerciseMetaEl.textContent =
        `${currentExercise.muscle_group} · ${currentExercise.default_day} · ${currentExercise.default_unit}`;
    }

    // ===========================
    // Ladda övningar från API
    // ===========================
    async function loadExercisesFromApi() {
      statusTextEl.textContent = "Hämtar övningar från API …";
      loadingStateEl.style.display = "block";

      try {
        const res = await fetch(GET_EXERCISES_URL, { method: "POST" });
        const data = await res.json();
        console.log("DATA FRÅN MAKE:", data);

        // rows kan vara antingen array eller objekt med 0,1,2… som nycklar
        const rawRows = Array.isArray(data.rows)
          ? data.rows
          : Object.values(data.rows);

        EXERCISES = rawRows.map(r => ({
          exercise_id: Number(r["0"]),
          name: r["1"],
          muscle_group: r["2"],
          default_day: r["3"],
          default_unit: r["4"],
          is_active: String(r["5"]).toUpperCase() === "TRUE"
        })).filter(e => e.is_active);

        if (!EXERCISES.length) {
          statusTextEl.textContent = "Inga aktiva övningar hittades. Kontrollera is_active i Google Sheets.";
          loadingStateEl.style.display = "none";
          renderTabs();
          renderExerciseList();
          return;
        }

        // Bygg flikar utifrån default_day
        const days = [...new Set(EXERCISES.map(e => e.default_day))].filter(Boolean);
        MUSCLE_GROUP_TABS = days.map(day => ({ key: day, label: day }));
        currentGroupKey = MUSCLE_GROUP_TABS[0]?.key || null;

        statusTextEl.textContent = `Hämtade ${EXERCISES.length} övningar från Google Sheets.`;
        loadingStateEl.style.display = "none";

        renderTabs();
        renderExerciseList();
        renderSelectedExercise();
      } catch (err) {
        console.error("Fel vid hämtning av övningar:", err);
        statusTextEl.textContent = "Kunde inte hämta övningar från API. Kolla konsolen för detaljer.";
        loadingStateEl.style.display = "none";
      }
    }

    // Init
    window.addEventListener("load", loadExercisesFromApi);
  </script>
</body>
</html>

